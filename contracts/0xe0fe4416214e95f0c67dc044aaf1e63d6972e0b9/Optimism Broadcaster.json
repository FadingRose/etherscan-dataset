{
  "TxHash": "0xec4c1c716b478aa795297d555af67640dce01702d3bc42b5e6497e70b80b6299",
  "ContractAddress": "0xe0fe4416214e95f0c67dc044aaf1e63d6972e0b9",
  "Name": "Optimism Broadcaster",
  "PackageStatus": 0,
  "status": "1",
  "message": "OK",
  "result": [
    {
      "SourceCode": "# pragma version 0.3.10\r\n\"\"\"\r\n@title Optimism Broadcaster\r\n@author CurveFi\r\n@license MIT\r\n@custom:version 1.0.1\r\n\"\"\"\r\n\r\n\r\nversion: public(constant(String[8])) = \"1.0.1\"\r\n\r\n\r\ninterface OVMChain:\r\n    def enqueueL2GasPrepaid() -\u003e uint32: view\r\n\r\n\r\nevent Broadcast:\r\n    chain_id: indexed(uint256)\r\n    agent: indexed(Agent)\r\n    messages: DynArray[Message, MAX_MESSAGES]\r\n\r\nevent SetDestinationData:\r\n    chain_id: indexed(uint256)\r\n    data: DestinationData\r\n\r\nevent ApplyAdmins:\r\n    admins: AdminSet\r\n\r\nevent CommitAdmins:\r\n    future_admins: AdminSet\r\n\r\n\r\nenum Agent:\r\n    OWNERSHIP\r\n    PARAMETER\r\n    EMERGENCY\r\n\r\n\r\nstruct AdminSet:\r\n    ownership: address\r\n    parameter: address\r\n    emergency: address\r\n\r\nstruct Message:\r\n    target: address\r\n    data: Bytes[MAX_BYTES]\r\n\r\n\r\nstruct DestinationData:\r\n    ovm_chain: OVMChain  # CanonicalTransactionChain\r\n    ovm_messenger: address  # CrossDomainMessenger\r\n    relayer: address\r\n\r\n\r\nMAX_BYTES: constant(uint256) = 1024\r\nMAX_MESSAGES: constant(uint256) = 8\r\n\r\n\r\nadmins: public(AdminSet)\r\nfuture_admins: public(AdminSet)\r\n\r\ndestination_data: public(HashMap[uint256, DestinationData])\r\nagent: HashMap[address, Agent]\r\n\r\n\r\n@external\r\ndef __init__(_admins: AdminSet):\r\n    assert _admins.ownership != _admins.parameter  # a != b\r\n    assert _admins.ownership != _admins.emergency  # a != c\r\n    assert _admins.parameter != _admins.emergency  # b != c\r\n\r\n    self.admins = _admins\r\n\r\n    self.agent[_admins.ownership] = Agent.OWNERSHIP\r\n    self.agent[_admins.parameter] = Agent.PARAMETER\r\n    self.agent[_admins.emergency] = Agent.EMERGENCY\r\n\r\n    log ApplyAdmins(_admins)\r\n\r\n\r\n@external\r\ndef broadcast(_chain_id: uint256, _messages: DynArray[Message, MAX_MESSAGES], _gas_limit: uint32 = 0, _destination_data: DestinationData=empty(DestinationData)):\r\n    \"\"\"\r\n    @notice Broadcast a sequence of messages.\r\n    @param _chain_id Chain ID of L2\r\n    @param _messages The sequence of messages to broadcast.\r\n    @param _gas_limit The L2 gas limit required to execute the sequence of messages.\r\n    @param _destination_data Specific DestinationData (self.destination_data by default)\r\n    \"\"\"\r\n    agent: Agent = self.agent[msg.sender]\r\n    assert agent != empty(Agent)\r\n    destination: DestinationData = _destination_data\r\n    if destination.relayer == empty(address):\r\n        destination = self.destination_data[_chain_id]\r\n    assert destination.relayer != empty(address)\r\n\r\n    # https://community.optimism.io/docs/developers/bridge/messaging/#for-l1-%E2%87%92-l2-transactions\r\n    gas_limit: uint32 = _gas_limit\r\n    if gas_limit == 0:\r\n        gas_limit = destination.ovm_chain.enqueueL2GasPrepaid()\r\n\r\n    raw_call(\r\n        destination.ovm_messenger,\r\n        _abi_encode(  # sendMessage(address,bytes,uint32)\r\n            destination.relayer,\r\n            _abi_encode(  # relay(uint256,(address,bytes)[])\r\n                agent,\r\n                _messages,\r\n                method_id=method_id(\"relay(uint256,(address,bytes)[])\"),\r\n            ),\r\n            gas_limit,\r\n            method_id=method_id(\"sendMessage(address,bytes,uint32)\"),\r\n        ),\r\n    )\r\n\r\n\r\n@external\r\ndef set_destination_data(_chain_id: uint256, _destination_data: DestinationData):\r\n    \"\"\"\r\n    @notice Set destination data for child chain.\r\n    \"\"\"\r\n    assert msg.sender == self.admins.ownership\r\n    self.destination_data[_chain_id] = _destination_data\r\n    log SetDestinationData(_chain_id, _destination_data)\r\n\r\n\r\n@external\r\ndef commit_admins(_future_admins: AdminSet):\r\n    \"\"\"\r\n    @notice Commit an admin set to use in the future.\r\n    \"\"\"\r\n    assert msg.sender == self.admins.ownership\r\n\r\n    assert _future_admins.ownership != _future_admins.parameter  # a != b\r\n    assert _future_admins.ownership != _future_admins.emergency  # a != c\r\n    assert _future_admins.parameter != _future_admins.emergency  # b != c\r\n\r\n    self.future_admins = _future_admins\r\n    log CommitAdmins(_future_admins)\r\n\r\n\r\n@external\r\ndef apply_admins():\r\n    \"\"\"\r\n    @notice Apply the future admin set.\r\n    \"\"\"\r\n    admins: AdminSet = self.admins\r\n    assert msg.sender == admins.ownership\r\n\r\n    # reset old admins\r\n    self.agent[admins.ownership] = empty(Agent)\r\n    self.agent[admins.parameter] = empty(Agent)\r\n    self.agent[admins.emergency] = empty(Agent)\r\n\r\n    # set new admins\r\n    future_admins: AdminSet = self.future_admins\r\n    self.agent[future_admins.ownership] = Agent.OWNERSHIP\r\n    self.agent[future_admins.parameter] = Agent.PARAMETER\r\n    self.agent[future_admins.emergency] = Agent.EMERGENCY\r\n\r\n    self.admins = future_admins\r\n    log ApplyAdmins(future_admins)",
      "ABI": "[{\"name\":\"Broadcast\",\"inputs\":[{\"name\":\"chain_id\",\"type\":\"uint256\",\"indexed\":true},{\"name\":\"agent\",\"type\":\"uint256\",\"indexed\":true},{\"name\":\"messages\",\"type\":\"tuple[]\",\"components\":[{\"name\":\"target\",\"type\":\"address\"},{\"name\":\"data\",\"type\":\"bytes\"}],\"indexed\":false}],\"anonymous\":false,\"type\":\"event\"},{\"name\":\"SetDestinationData\",\"inputs\":[{\"name\":\"chain_id\",\"type\":\"uint256\",\"indexed\":true},{\"name\":\"data\",\"type\":\"tuple\",\"components\":[{\"name\":\"ovm_chain\",\"type\":\"address\"},{\"name\":\"ovm_messenger\",\"type\":\"address\"},{\"name\":\"relayer\",\"type\":\"address\"}],\"indexed\":false}],\"anonymous\":false,\"type\":\"event\"},{\"name\":\"ApplyAdmins\",\"inputs\":[{\"name\":\"admins\",\"type\":\"tuple\",\"components\":[{\"name\":\"ownership\",\"type\":\"address\"},{\"name\":\"parameter\",\"type\":\"address\"},{\"name\":\"emergency\",\"type\":\"address\"}],\"indexed\":false}],\"anonymous\":false,\"type\":\"event\"},{\"name\":\"CommitAdmins\",\"inputs\":[{\"name\":\"future_admins\",\"type\":\"tuple\",\"components\":[{\"name\":\"ownership\",\"type\":\"address\"},{\"name\":\"parameter\",\"type\":\"address\"},{\"name\":\"emergency\",\"type\":\"address\"}],\"indexed\":false}],\"anonymous\":false,\"type\":\"event\"},{\"stateMutability\":\"nonpayable\",\"type\":\"constructor\",\"inputs\":[{\"name\":\"_admins\",\"type\":\"tuple\",\"components\":[{\"name\":\"ownership\",\"type\":\"address\"},{\"name\":\"parameter\",\"type\":\"address\"},{\"name\":\"emergency\",\"type\":\"address\"}]}],\"outputs\":[]},{\"stateMutability\":\"nonpayable\",\"type\":\"function\",\"name\":\"broadcast\",\"inputs\":[{\"name\":\"_chain_id\",\"type\":\"uint256\"},{\"name\":\"_messages\",\"type\":\"tuple[]\",\"components\":[{\"name\":\"target\",\"type\":\"address\"},{\"name\":\"data\",\"type\":\"bytes\"}]}],\"outputs\":[]},{\"stateMutability\":\"nonpayable\",\"type\":\"function\",\"name\":\"broadcast\",\"inputs\":[{\"name\":\"_chain_id\",\"type\":\"uint256\"},{\"name\":\"_messages\",\"type\":\"tuple[]\",\"components\":[{\"name\":\"target\",\"type\":\"address\"},{\"name\":\"data\",\"type\":\"bytes\"}]},{\"name\":\"_gas_limit\",\"type\":\"uint32\"}],\"outputs\":[]},{\"stateMutability\":\"nonpayable\",\"type\":\"function\",\"name\":\"broadcast\",\"inputs\":[{\"name\":\"_chain_id\",\"type\":\"uint256\"},{\"name\":\"_messages\",\"type\":\"tuple[]\",\"components\":[{\"name\":\"target\",\"type\":\"address\"},{\"name\":\"data\",\"type\":\"bytes\"}]},{\"name\":\"_gas_limit\",\"type\":\"uint32\"},{\"name\":\"_destination_data\",\"type\":\"tuple\",\"components\":[{\"name\":\"ovm_chain\",\"type\":\"address\"},{\"name\":\"ovm_messenger\",\"type\":\"address\"},{\"name\":\"relayer\",\"type\":\"address\"}]}],\"outputs\":[]},{\"stateMutability\":\"nonpayable\",\"type\":\"function\",\"name\":\"set_destination_data\",\"inputs\":[{\"name\":\"_chain_id\",\"type\":\"uint256\"},{\"name\":\"_destination_data\",\"type\":\"tuple\",\"components\":[{\"name\":\"ovm_chain\",\"type\":\"address\"},{\"name\":\"ovm_messenger\",\"type\":\"address\"},{\"name\":\"relayer\",\"type\":\"address\"}]}],\"outputs\":[]},{\"stateMutability\":\"nonpayable\",\"type\":\"function\",\"name\":\"commit_admins\",\"inputs\":[{\"name\":\"_future_admins\",\"type\":\"tuple\",\"components\":[{\"name\":\"ownership\",\"type\":\"address\"},{\"name\":\"parameter\",\"type\":\"address\"},{\"name\":\"emergency\",\"type\":\"address\"}]}],\"outputs\":[]},{\"stateMutability\":\"nonpayable\",\"type\":\"function\",\"name\":\"apply_admins\",\"inputs\":[],\"outputs\":[]},{\"stateMutability\":\"view\",\"type\":\"function\",\"name\":\"version\",\"inputs\":[],\"outputs\":[{\"name\":\"\",\"type\":\"string\"}]},{\"stateMutability\":\"view\",\"type\":\"function\",\"name\":\"admins\",\"inputs\":[],\"outputs\":[{\"name\":\"\",\"type\":\"tuple\",\"components\":[{\"name\":\"ownership\",\"type\":\"address\"},{\"name\":\"parameter\",\"type\":\"address\"},{\"name\":\"emergency\",\"type\":\"address\"}]}]},{\"stateMutability\":\"view\",\"type\":\"function\",\"name\":\"future_admins\",\"inputs\":[],\"outputs\":[{\"name\":\"\",\"type\":\"tuple\",\"components\":[{\"name\":\"ownership\",\"type\":\"address\"},{\"name\":\"parameter\",\"type\":\"address\"},{\"name\":\"emergency\",\"type\":\"address\"}]}]},{\"stateMutability\":\"view\",\"type\":\"function\",\"name\":\"destination_data\",\"inputs\":[{\"name\":\"arg0\",\"type\":\"uint256\"}],\"outputs\":[{\"name\":\"\",\"type\":\"tuple\",\"components\":[{\"name\":\"ovm_chain\",\"type\":\"address\"},{\"name\":\"ovm_messenger\",\"type\":\"address\"},{\"name\":\"relayer\",\"type\":\"address\"}]}]}]",
      "ContractName": "Optimism Broadcaster",
      "CompilerVersion": "vyper:0.3.10",
      "OptimizationUsed": "0",
      "Runs": "0",
      "ConstructorArguments": "00000000000000000000000071f718d3e4d1449d1502a6a7595eb84ebccb16830000000000000000000000004eeb3ba4f221ca16ed4a0cc7254e2e32df948c5f000000000000000000000000467947ee34af926cf1dcac093870f613c96b1e0c",
      "EVMVersion": "Default",
      "Library": "",
      "LicenseType": "MIT",
      "Proxy": "0",
      "Implementation": "",
      "SwarmSource": ""
    }
  ]
}
